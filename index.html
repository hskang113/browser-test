<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chromium Feature Test - Final Revision</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f4f7f6; color: #333; }
        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-bottom: 20px; }
        .feature-section { background-color: #ffffff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 20px; padding: 20px; }
        .feature-section h2 { color: #34495e; margin-top: 0; }
        .test-button { background-color: #3498db; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 1em; transition: background-color 0.3s ease; margin-top: 10px; }
        .test-button:hover { background-color: #2980b9; }
        .result { margin-top: 15px; padding: 10px; border-radius: 5px; font-weight: bold; }
        .supported { background-color: #e6ffe6; color: #28a745; border: 1px solid #28a745; }
        .not-supported { background-color: #ffe6e6; color: #dc3545; border: 1px solid #dc3545; }
        .demo-output { margin-top: 10px; padding: 10px; background-color: #f0f0f0; border: 1px dashed #ccc; border-radius: 5px; min-height: 50px; display: flex; align-items: center; justify-content: center; font-style: italic; color: #666; flex-direction: column; text-align: center;}
        .demo-box { width: 50px; height: 50px; transition: background-color 0.5s ease; }
        .color-mix-box { width: 80px; height: 80px; margin-top: 10px; }
        #themeBox { width: 100px; height: 100px; border-radius: 5px; }
        #popoverTargetBtn { background-color: #f1c40f; padding: 10px; cursor: pointer; border-radius: 5px; display: inline-block;}
        #my-popover { background-color: #2ecc71; color: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        #anchorContainer {
            position: relative;
            width: 300px;
            height: 200px;
            border: 2px dashed #999;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #anchorElement {
            position: absolute;
            background-color: #27ae60;
            color: white;
            padding: 10px;
            border-radius: 5px;
        }
        #floatingElement {
            background-color: #8e44ad;
            color: white;
            padding: 8px;
            border-radius: 5px;
            position: absolute;
            display: none; /* Controlled by JS */
        }
    </style>
</head>
<body>
    <h1>Chromium 기능 지원 테스트 (최종 개정판)</h1>
    <p>아래 버튼을 클릭하여 각 기능의 지원 여부를 확인하세요. 문제가 발생하면 **개발자 도구 (F12) 콘솔**을 확인하고 오류 메시지를 알려주세요.</p>

    <div class="feature-section">
        <h2>1. View Transitions API (Chrome 111+)</h2>
        <button class="test-button" id="viewTransitionsBtn">View Transitions 테스트</button>
        <div id="viewTransitionsResult" class="result"></div>
        <div id="viewTransitionsDemo" class="demo-output">
            <div id="viewTransitionBox" class="demo-box" style="background-color: #e74c3c;"></div>
            <p>클릭 시 박스 색상/위치 변화에 애니메이션이 적용되면 지원됩니다.</p>
        </div>
    </div>

    <div class="feature-section">
        <h2>2. CSS color-mix() 함수 (Chrome 111+)</h2>
        <button class="test-button" id="colorMixBtn">color-mix() 테스트</button>
        <div id="colorMixResult" class="result"></div>
        <div id="colorMixDemo" class="demo-output">
            <div class="color-mix-box" id="colorMixTestBox"></div>
            <p>이 박스의 색상이 빨강과 파랑의 혼합(약간 보라색)으로 보이면 지원됩니다. <br/>계산된 색상: <span id="computedColorValue">N/A</span></p>
        </div>
    </div>

    <div class="feature-section">
        <h2>3. WebGPU API (Chrome 113+)</h2>
        <button class="test-button" id="webGPUBtn">WebGPU 테스트</button>
        <div id="webGPUResult" class="result"></div>
    </div>

    <div class="feature-section">
        <h2>4. Popover API (Chrome 114+, stable in 127+)</h2>
        <button class="test-button" id="popoverTargetBtn" popovertarget="my-popover">나를 클릭해서 팝오버 보기</button>
        <div id="popoverResult" class="result"></div>
        <div id="my-popover" popover>
            <p>이것은 팝오버입니다!</p>
            <button onclick="document.getElementById('my-popover').hidePopover()">닫기</button>
        </div>
    </div>

    <div class="feature-section">
        <h2>5. CSS light-dark() 함수 (Chrome 121+)</h2>
        <button class="test-button" id="lightDarkBtn">light-dark() 테스트</button>
        <div id="lightDarkResult" class="result"></div>
        <div id="lightDarkDemo" class="demo-output">
            <div id="themeBox" style="background-color: #ccc;"></div>
            <p>시스템 테마를 변경하고 페이지를 새로고침 해보세요. 색상이 바뀌면 지원됩니다.<br/>현재 배경: <span id="currentThemeColor">N/A</span></p>
        </div>
    </div>

    <div class="feature-section">
        <h2>6. CSS Anchor Positioning (Chrome 125+)</h2>
        <div id="anchorContainer">
            <div id="anchorElement">기준 요소</div>
            <div id="floatingElement">나는 기준 요소의 아래에 고정될 거야!</div>
        </div>
        <button class="test-button" id="anchorPositioningBtn">Anchor Positioning 테스트</button>
        <div id="anchorPositioningResult" class="result"></div>
    </div>

    <script>
        function showResult(id, message, isSupported) {
            const element = document.getElementById(id);
            if (!element) {
                console.error(`Error: Result element with ID '${id}' not found.`);
                return;
            }
            element.textContent = message;
            element.className = 'result ' + (isSupported ? 'supported' : 'not-supported');
            console.log(`[${id}] Result: ${message}`);
        }

        // --- 테스트 함수들 ---

        function testViewTransitions() {
            try {
                if (document.startViewTransition) {
                    showResult('viewTransitionsResult', '✔ View Transitions API가 지원됩니다.', true);
                    const box = document.getElementById('viewTransitionBox');
                    document.startViewTransition(() => {
                        const isRed = box.style.backgroundColor === 'rgb(231, 76, 60)';
                        box.style.backgroundColor = isRed ? '#3498db' : '#e74c3c';
                        box.style.transform = isRed ? 'translateX(0px) rotate(0deg)' : 'translateX(50px) rotate(45deg)';
                    });
                } else {
                    showResult('viewTransitionsResult', '✖ View Transitions API가 지원되지 않습니다.', false);
                }
            } catch (e) {
                showResult('viewTransitionsResult', `오류 발생: ${e.message}`, false);
                console.error('testViewTransitions error:', e);
            }
        }

                // CSS color-mix() 함수 (Chrome 111+) - 수정된 버전
        function testColorMix() {
            try {
                const testBox = document.getElementById('colorMixTestBox');
                const computedColorValueSpan = document.getElementById('computedColorValue');

                // 1단계: CSS.supports()를 사용하여 문법 지원 여부 확인
                const supportsColorMixSyntax = CSS.supports('background-color', 'color-mix(in srgb, red 80%, blue 20%)');

                if (!supportsColorMixSyntax) {
                    showResult('colorMixResult', '✖ color-mix() 함수 문법이 지원되지 않습니다.', false);
                    computedColorValueSpan.textContent = 'N/A (문법 미지원)';
                    // 지원되지 않을 때는 기본 색상으로 설정
                    testBox.style.backgroundColor = '#ecf0f1';
                    return;
                }

                // color-mix 효과를 적용하고 유지
                testBox.style.backgroundColor = 'color-mix(in srgb, red 80%, blue 20%)';

                // 잠시 기다린 후 계산된 색상 확인 (브라우저가 색상을 계산할 시간을 줌)
                setTimeout(() => {
                    const computedColor = getComputedStyle(testBox).backgroundColor;
                    computedColorValueSpan.textContent = computedColor;

                    // 2단계: 실제로 색상이 혼합되었는지 확인
                    if (computedColor.startsWith('rgb(') || computedColor.startsWith('rgba(') || computedColor.startsWith('color(srgb')) {
                        // RGB 값이 예상 범위 내에 있는지 확인 (빨강+파랑 혼합이므로 R값이 높고 B값이 중간 정도)
                        const rgbMatch = computedColor.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
                        if (rgbMatch) {
                            const r = parseInt(rgbMatch[1]);
                            const g = parseInt(rgbMatch[2]);
                            const b = parseInt(rgbMatch[3]);

                            // 빨강 80% + 파랑 20% 혼합의 예상 범위 (R: 200-255, G: 0-50, B: 50-100)
                            if (r > 180 && g < 60 && b > 40 && b < 120) {
                                showResult('colorMixResult', '✔ color-mix() 함수가 지원되며, 정상적으로 적용되었습니다.', true);
                            } else {
                                showResult('colorMixResult', `✖ color-mix() 함수가 지원되지만 예상과 다른 색상입니다: ${computedColor}`, false);
                            }
                        } else {
                            showResult('colorMixResult', '✔ color-mix() 함수가 지원되며, 정상적으로 적용되었습니다.', true);
                        }
                    } else {
                        showResult('colorMixResult', `✖ color-mix() 함수는 문법적으로 지원되지만, 실제 적용되지 않았습니다. (계산된 값: ${computedColor})`, false);
                        // 실패 시 기본 색상으로 설정
                        testBox.style.backgroundColor = '#ecf0f1';
                    }
                }, 100);

            } catch (e) {
                showResult('colorMixResult', `오류 발생: ${e.message}`, false);
                console.error('testColorMix error:', e);
                // 오류 시 기본 색상으로 설정
                testBox.style.backgroundColor = '#ecf0f1';
            }
        }

        function testWebGPU() {
            try {
                if (navigator.gpu) {
                    showResult('webGPUResult', '✔ WebGPU API가 지원됩니다.', true);
                } else {
                    showResult('webGPUResult', '✖ WebGPU API가 지원되지 않습니다.', false);
                }
            } catch (e) {
                showResult('webGPUResult', `오류 발생: ${e.message}`, false);
                console.error('testWebGPU error:', e);
            }
        }

        function checkPopoverAPI() {
            try {
                const popoverElement = document.getElementById('my-popover');
                if (popoverElement && 'showPopover' in popoverElement) {
                    showResult('popoverResult', '✔ Popover API가 지원됩니다.', true);
                } else {
                    showResult('popoverResult', '✖ Popover API가 지원되지 않습니다.', false);
                }
            } catch (e) {
                showResult('popoverResult', `오류 발생: ${e.message}`, false);
                console.error('checkPopoverAPI error:', e);
            }
        }

        function testLightDark() {
            try {
                const themeBox = document.getElementById('themeBox');
                const currentThemeColorSpan = document.getElementById('currentThemeColor');

                const originalStyle = themeBox.style.backgroundColor;
                themeBox.style.backgroundColor = 'light-dark(rgb(230, 255, 230), rgb(50, 50, 50))';
                const computedColor = getComputedStyle(themeBox).backgroundColor;
                currentThemeColorSpan.textContent = computedColor;

                if (computedColor === 'rgb(230, 255, 230)' || computedColor === 'rgb(50, 50, 50)') {
                    showResult('lightDarkResult', '✔ light-dark() 함수가 지원됩니다.', true);
                } else {
                    showResult('lightDarkResult', `✖ light-dark() 함수가 지원되지 않거나 예상과 다릅니다: ${computedColor}`, false);
                }
                themeBox.style.backgroundColor = originalStyle; // 원래 스타일로 복원
            } catch (e) {
                showResult('lightDarkResult', `오류 발생: ${e.message}`, false);
                console.error('testLightDark error:', e);
            }
        }

        function testAnchorPositioning() {
            try {
                const floating = document.getElementById('floatingElement');
                const supportsAnchor = CSS.supports('top', 'anchor(top)');

                if (supportsAnchor) {
                    showResult('anchorPositioningResult', '✔ CSS Anchor Positioning이 지원됩니다.', true);
                    floating.style.display = 'block';
                    floating.style.position = 'absolute';
                    floating.style.top = 'anchor(bottom)';
                    floating.style.left = 'anchor(left)';
                    floating.style.backgroundColor = '#27ae60';
                } else {
                    showResult('anchorPositioningResult', '✖ CSS Anchor Positioning이 지원되지 않습니다.', false);
                    floating.style.display = 'none';
                    floating.style.backgroundColor = '#8e44ad';
                }
            } catch (e) {
                showResult('anchorPositioningResult', `오류 발생: ${e.message}`, false);
                console.error('testAnchorPositioning error:', e);
            }
        }

        // --- 이벤트 리스너 등록 ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('viewTransitionsBtn').addEventListener('click', testViewTransitions);
            document.getElementById('colorMixBtn').addEventListener('click', testColorMix);
            document.getElementById('webGPUBtn').addEventListener('click', testWebGPU);
            document.getElementById('lightDarkBtn').addEventListener('click', testLightDark);
            document.getElementById('anchorPositioningBtn').addEventListener('click', testAnchorPositioning);

            checkPopoverAPI();
            testLightDark(); // light-dark는 시스템 테마에 따라 달라지므로 초기에도 확인

            const lazyLoadingImg = document.querySelector('.lazy-img');
            if (lazyLoadingImg && 'loading' in lazyLoadingImg) {
                showResult('lazyLoadingResult', '✔ Native Lazy Loading이 지원됩니다.', true);
            } else {
                showResult('lazyLoadingResult', '✖ Native Lazy Loading이 지원되지 않습니다.', false);
            }
        });
    </script>
</body>
</html>